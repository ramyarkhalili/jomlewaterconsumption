[
  {
    "objectID": "index.html",
    "href": "index.html",
    "title": "Jomle Water Consumption",
    "section": "",
    "text": "This is a Quarto website.\nTo learn more about Quarto websites visit https://quarto.org/docs/websites."
  },
  {
    "objectID": "WaterConsumption.html",
    "href": "WaterConsumption.html",
    "title": "Jomle Water Consumption",
    "section": "",
    "text": "Code\nimport pandas as pd\nimport plotly.graph_objects as go\nimport plotly.express as px\n\ndef read_gsheet_by_id(sheet_id, sheet_name):\n    url = (\n        f\"https://docs.google.com/spreadsheets/d/{sheet_id}/gviz/tq?\"\n        f\"tqx=out:csv&sheet={sheet_name}\"\n    )\n    return pd.read_csv(url)\n\nSHEET_ID = \"17EXH6oZeXsDfnMrIerT1EiMEjcQyLhdoQXzOe7YJJVg\"\n\ncomp = read_gsheet_by_id(SHEET_ID, \"ConsumptionLog\")\nevents = read_gsheet_by_id(SHEET_ID, \"EventLog\")\n\n# ----------------------------\n# Filter empty counter cells\n# ----------------------------\ncomp = comp[comp[\"شمارنده کنتور\"].notna() & (comp[\"شمارنده کنتور\"] != \"\")]\ncomp[\"شمارنده کنتور\"] = comp[\"شمارنده کنتور\"].str.replace(\",\", \"\", regex=False).astype(float)\ncomp[\"اختلاف با قبلی\"] = comp[\"شمارنده کنتور\"].diff().fillna(0)\n\n\nCLOCK=[f\"{i:02d}:00\" for i in range(24)]\n\n# Convert ساعت to minutes\ndef hour_to_minutes(t):\n    h, m = map(int, t.split(\":\"))\n    return h*60 + m\n\ncomp[\"minutes\"] = comp[\"ساعت\"].apply(hour_to_minutes)\nevents[\"minutes\"] = events[\"ساعت\"].apply(hour_to_minutes)\n\n# Compute y_p\ncomp[\"y_p\"] = comp[\"اختلاف با قبلی\"] * 1000\ncomp[\"y_p\"] = pd.to_numeric(comp[\"y_p\"], errors=\"coerce\")\n\n\n# ----------------------------\n# Create a figure with dropdowns\n# ----------------------------\n\ndates = comp[\"تاریخ\"].unique()\n\n\n\n\n\nCode\na = (comp\n     .groupby(\"تاریخ\")[\"y_p\"]\n     .agg(total=\"sum\", max=\"max\")\n     .reset_index()\n     )\n\n\na[\"x\"] = range(len(a))\n\ntotal_fig = go.Figure()\n\ntotal_fig.add_trace(\n    go.Bar(\n        x=a[\"x\"],      # numeric axis\n        y=a[\"total\"],\n        text=[f\"{v:.0f}\" for v in a[\"total\"]],   # numbers to show\n        textposition=\"inside\", # place above bar\n        textfont=dict(size=12)\n    )\n)\n\ntotal_fig.update_xaxes(\n    tickmode=\"array\",\n    tickvals=a[\"x\"],         # numeric positions\n    ticktext=a[\"تاریخ\"],      # visible labels\n\n)\n\ntotal_fig.update_layout(\n    xaxis_title=\"تاریخ\",\n    yaxis_title=\"مجموع مصرف (لیتر)\",\n    uniformtext_minsize=10,\n    uniformtext_mode=\"show\",\n    title=\"مصرف روزانه\",\n    title_x=0.5\n)\n\ntotal_fig.show()\n\n\n\n\n\n\n\n\n\n\n\nCode\ndef consumption(df, date):\n    return(\n        go.Scatter(\n            x=df[\"minutes\"],\n            y=df[\"y_p\"],\n            mode=\"lines+markers+text\",\n            text=[f\"{v:.1f}\" for v in df[\"y_p\"]],\n            textposition=\"top center\",\n            textfont=dict(size=11),\n            hovertemplate=\"ساعت: %{x}&lt;br&gt;مقدار: %{y:.1f} لیتر&lt;extra&gt;&lt;/extra&gt;\",\n            name=str(date)\n        )\n    )\n\n# Add one trace per date\nfor date in dates:\n    fig = go.Figure()\n    comp_date = comp[comp[\"تاریخ\"] == date]\n    events_date = events[events[\"تاریخ\"] == date]\n\n    # Main line+markers+text trace\n    fig.add_trace(\n        consumption(comp_date, date)\n        )\n\n    # Event markers\n    for _, e in events_date.iterrows():\n        closest_idx = (comp_date[\"minutes\"] - e[\"minutes\"]).abs().idxmin()\n        y_value = comp_date.loc[closest_idx, \"y_p\"]\n        fig.add_trace(\n            go.Scatter(\n                x=[e[\"minutes\"]],\n                y=[y_value],\n                mode=\"markers\",\n                hovertext=[e[\"رویداد\"]],\n                marker=dict(size=10, color=\"red\", symbol=\"diamond\"),\n                hoverinfo=\"text\",\n            )\n        )\n\n    fig.update_layout(\n        #updatemenus=[dict(active=0, buttons=buttons, x=0.5, xanchor=\"center\", y=1.15, yanchor=\"top\")],\n        xaxis=dict(title=\"ساعت\", tickvals=comp[\"minutes\"], ticktext=comp[\"ساعت\"]),\n        yaxis=dict(title=\"میزان مصرف (لیتر)\", range=[0, comp[\"y_p\"].max() + 50]),\n        showlegend=False,\n        title = date,\n        title_x=0.5,\n    )\n    \n    fig.show()"
  },
  {
    "objectID": "about.html",
    "href": "about.html",
    "title": "About",
    "section": "",
    "text": "About this site"
  }
]